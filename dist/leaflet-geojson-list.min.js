/* 
 * Leaflet GeoJSON List v0.1.0 - 2015-03-22 
 * 
 * Copyright 2015 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demo: 
 * http://labs.easyblog.it/maps/leaflet-geojson-list/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-geojson-list.git 
 * 
 */
(function(){L.Control.GeoJSONList=L.Control.extend({includes:L.Mixin.Events,options:{collapsed:!1,position:"bottomleft",listLabel:"name",activeListFromLayer:!0,activeEventList:"click",activeEventLayer:"mouseover",activeClass:"active",activeStyle:{color:"#00f",fillColor:"#fa0",weight:1,opacity:1,fillOpacity:.6},style:{color:"#00f",fillColor:"#08f",weight:1,opacity:1,fillOpacity:.4}},initialize:function(a,b){L.Util.setOptions(this,b),this._layer=a},onAdd:function(a){this._map=a;var b=L.DomUtil.create("div","geojson-list");return this._container=b,this._list=L.DomUtil.create("ul","geojson-list-ul",b),this._initToggle(),this._updateList(),L.DomEvent.on(b,"mouseover",function(){a.scrollWheelZoom.disable()}).on(b,"mouseout",function(){a.scrollWheelZoom.enable()}),a.whenReady(function(a){b.style.height=a.getSize().y+"px"}),b},onRemove:function(a){a.off("moveend",this._updateList,this)},_createItem:function(a){var b=L.DomUtil.create("li","geojson-list-li"),c=L.DomUtil.create("a","",b),d=this;return a.itemList=c,c.href="#",L.DomEvent.disableClickPropagation(c).on(c,this.options.activeEventList,L.DomEvent.stop,this).on(c,this.options.activeEventList,function(){d._moveTo(a),d.fire("item-active",{layer:a})},this).on(c,"mouseover",function(b){L.DomUtil.addClass(b.target,this.options.activeClass),a.setStyle(d.options.activeStyle)},this).on(c,"mouseout",function(b){L.DomUtil.removeClass(b.target,this.options.activeClass),a.setStyle(d.options.style)},this),a.feature.properties.hasOwnProperty(this.options.listLabel)?c.innerHTML="<span>"+a.feature.properties[this.options.listLabel]+"</span>":console.log("propertyName '"+this.options.listLabel+"' not found in GeoJSON"),b},_updateList:function(){var a=this;this._list.innerHTML="",this._layer.eachLayer(function(b){a._list.appendChild(a._createItem(b)),b.setStyle(a.options.style),a.options.activeListFromLayer&&b.on("mouseover",function(){b.setStyle(a.options.activeStyle),L.DomUtil.addClass(b.itemList,a.options.activeClass)}).on("mouseout",function(){b.setStyle(a.options.style),L.DomUtil.removeClass(b.itemList,a.options.activeClass)})})},_initToggle:function(){var a=this._container;if(a.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(a,"click",L.DomEvent.stopPropagation):L.DomEvent.disableClickPropagation(a),this.options.collapsed){this._collapse(),L.Browser.android||L.DomEvent.on(a,"mouseover",this._expand,this).on(a,"mouseout",this._collapse,this);var b=this._button=L.DomUtil.create("a","geojson-list-toggle",a);b.href="#",b.title="List GeoJSON",L.Browser.touch?L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,"click",this._expand,this):L.DomEvent.on(b,"focus",this._expand,this),this._map.on("click",this._collapse,this)}},_expand:function(){this._container.className=this._container.className.replace(" geojson-list-collapsed","")},_collapse:function(){L.DomUtil.addClass(this._container,"geojson-list-collapsed")},_moveTo:function(a){this._map.fitBounds(a.getBounds().pad(1))}}),L.control.geoJsonList=function(a){return new L.Control.GeoJSONList(a)}}).call(this);